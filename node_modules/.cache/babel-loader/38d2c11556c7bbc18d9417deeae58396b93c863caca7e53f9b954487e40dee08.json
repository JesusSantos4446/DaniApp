{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import{ThemeProvider}from\"./context/ThemeContext\";import{reverseGeocode}from\"./services/geocode\";import Header from\"./components/Header\";import WeatherList from\"./components/WeatherList\";import CurrentCard from\"./components/CurrentCard\";import{fetchCurrentWeather}from\"./services/weather\";import{CITIES}from\"./components/CityPicker\";import WeeklyForecast from\"./components/WeeklyForecast\";// nuevos componentes\nimport Login from\"./components/Login\";import Home from\"./components/Home\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function App(){const[isLogged,setIsLogged]=useState(false);const[currentUser,setCurrentUser]=useState(null);const[view,setView]=useState(\"menu\");// \"menu\" | \"clima\"\n// ciudad actual (se llenar√° con geolocalizaci√≥n o b√∫squeda)\nconst[city,setCity]=useState(null);const[current,setCurrent]=useState(null);const[loadingCity,setLoadingCity]=useState(false);const[cityError,setCityError]=useState(\"\");// üîπ Obtener ciudad basada en geolocalizaci√≥n cuando entras a \"clima\"\nuseEffect(()=>{if(!isLogged||view!==\"clima\")return;// si ya hay ciudad (por b√∫squeda o bot√≥n), no volvemos a pedirla\nif(city)return;setLoadingCity(true);setCityError(\"\");navigator.geolocation.getCurrentPosition(pos=>{const{latitude,longitude}=pos.coords;(async()=>{const realCity=await reverseGeocode(latitude,longitude);setCity(realCity);})();setLoadingCity(false);},()=>{// si falla, usamos una ciudad por defecto\nsetCity(CITIES[1]);setCityError(\"No se pudo obtener tu ubicaci√≥n, usando ciudad por defecto.\");setLoadingCity(false);});},[isLogged,view,city]);// üîπ Pedir clima solo cuando:\n//  - est√° logueado\n//  - est√° en vista \"clima\"\n//  - ya tenemos una ciudad v√°lida\nuseEffect(()=>{if(!isLogged||view!==\"clima\"||!city)return;let alive=true;(async()=>{try{const data=await fetchCurrentWeather(city);if(alive)setCurrent(data);}catch(_unused){if(alive)setCurrent(null);}})();return()=>{alive=false;};},[isLogged,view,city===null||city===void 0?void 0:city.latitude,city===null||city===void 0?void 0:city.longitude]);// cuando el usuario elige una app en el men√∫\nconst handleSelectApp=app=>{if(app===\"clima\"){setView(\"clima\");setCity(null);// forzar que se vuelva a calcular ubicaci√≥n cuando entre\nsetCurrent(null);}else if(app===\"app2\"){window.open(\"https://ejemplo-app2.com\",\"_blank\");}else if(app===\"app3\"){window.open(\"https://ejemplo-app3.com\",\"_blank\");}else if(app===\"app4\"){window.open(\"https://ejemplo-app4.com\",\"_blank\");}};return/*#__PURE__*/_jsxs(ThemeProvider,{children:[!isLogged&&/*#__PURE__*/_jsx(Login,{onLogin:user=>{setCurrentUser(user);setIsLogged(true);setView(\"menu\");setCity(null);setCurrent(null);}}),isLogged&&view===\"menu\"&&/*#__PURE__*/_jsx(Home,{onSelectApp:handleSelectApp,user:currentUser}),isLogged&&view===\"clima\"&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Header,{city:city||{name:loadingCity?\"Obteniendo ubicaci√≥n...\":\"Ciudad\"},onCityChange:c=>{setCity(c);setCityError(\"\");}}),/*#__PURE__*/_jsxs(\"main\",{className:\"container row\",children:[cityError&&/*#__PURE__*/_jsx(\"div\",{className:\"card\",style:{width:\"100%\"},children:/*#__PURE__*/_jsx(\"p\",{style:{margin:0,color:\"#f44336\"},children:cityError})}),!city?/*#__PURE__*/_jsx(\"div\",{className:\"card\",style:{width:\"100%\"},children:/*#__PURE__*/_jsx(\"p\",{style:{margin:0},children:loadingCity?\"Obteniendo tu ubicaci√≥n...\":\"Selecciona una ciudad para ver el clima.\"})}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"card\",children:/*#__PURE__*/_jsx(CurrentCard,{current:current})}),/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsx(\"h3\",{style:{marginTop:0},children:\"Hoy\"}),/*#__PURE__*/_jsx(WeatherList,{city:city})]}),/*#__PURE__*/_jsx(\"div\",{className:\"card\",children:/*#__PURE__*/_jsx(WeeklyForecast,{city:city})})]})]})]})]});}","map":{"version":3,"names":["React","useEffect","useState","ThemeProvider","reverseGeocode","Header","WeatherList","CurrentCard","fetchCurrentWeather","CITIES","WeeklyForecast","Login","Home","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","App","isLogged","setIsLogged","currentUser","setCurrentUser","view","setView","city","setCity","current","setCurrent","loadingCity","setLoadingCity","cityError","setCityError","navigator","geolocation","getCurrentPosition","pos","latitude","longitude","coords","realCity","alive","data","_unused","handleSelectApp","app","window","open","children","onLogin","user","onSelectApp","name","onCityChange","c","className","style","width","margin","color","marginTop"],"sources":["C:/Users/jesus/Documents/DaniProject/react-api-mini/src/App.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { ThemeProvider } from \"./context/ThemeContext\";\nimport { reverseGeocode } from \"./services/geocode\";\nimport Header from \"./components/Header\";\nimport WeatherList from \"./components/WeatherList\";\nimport CurrentCard from \"./components/CurrentCard\";\nimport { fetchCurrentWeather } from \"./services/weather\";\nimport { CITIES } from \"./components/CityPicker\";\nimport WeeklyForecast from \"./components/WeeklyForecast\";\n\n// nuevos componentes\nimport Login from \"./components/Login\";\nimport Home from \"./components/Home\";\n\nexport default function App() {\n  const [isLogged, setIsLogged] = useState(false);\n  const [currentUser, setCurrentUser] = useState(null);\n  const [view, setView] = useState(\"menu\"); // \"menu\" | \"clima\"\n\n  // ciudad actual (se llenar√° con geolocalizaci√≥n o b√∫squeda)\n  const [city, setCity] = useState(null);\n  const [current, setCurrent] = useState(null);\n\n  const [loadingCity, setLoadingCity] = useState(false);\n  const [cityError, setCityError] = useState(\"\");\n\n  // üîπ Obtener ciudad basada en geolocalizaci√≥n cuando entras a \"clima\"\n  useEffect(() => {\n    if (!isLogged || view !== \"clima\") return;\n\n    // si ya hay ciudad (por b√∫squeda o bot√≥n), no volvemos a pedirla\n    if (city) return;\n\n    setLoadingCity(true);\n    setCityError(\"\");\n\n    navigator.geolocation.getCurrentPosition(\n      (pos) => {\n        const { latitude, longitude } = pos.coords;\n       (async () => {\n  const realCity = await reverseGeocode(latitude, longitude);\n  setCity(realCity);\n})();\n        setLoadingCity(false);\n      },\n      () => {\n        // si falla, usamos una ciudad por defecto\n        setCity(CITIES[1]);\n        setCityError(\"No se pudo obtener tu ubicaci√≥n, usando ciudad por defecto.\");\n        setLoadingCity(false);\n      }\n    );\n  }, [isLogged, view, city]);\n\n  // üîπ Pedir clima solo cuando:\n  //  - est√° logueado\n  //  - est√° en vista \"clima\"\n  //  - ya tenemos una ciudad v√°lida\n  useEffect(() => {\n    if (!isLogged || view !== \"clima\" || !city) return;\n\n    let alive = true;\n\n    (async () => {\n      try {\n        const data = await fetchCurrentWeather(city);\n        if (alive) setCurrent(data);\n      } catch {\n        if (alive) setCurrent(null);\n      }\n    })();\n\n    return () => {\n      alive = false;\n    };\n  }, [isLogged, view, city?.latitude, city?.longitude]);\n\n  // cuando el usuario elige una app en el men√∫\n  const handleSelectApp = (app) => {\n    if (app === \"clima\") {\n      setView(\"clima\");\n      setCity(null); // forzar que se vuelva a calcular ubicaci√≥n cuando entre\n      setCurrent(null);\n    } else if (app === \"app2\") {\n      window.open(\"https://ejemplo-app2.com\", \"_blank\");\n    } else if (app === \"app3\") {\n      window.open(\"https://ejemplo-app3.com\", \"_blank\");\n    } else if (app === \"app4\") {\n      window.open(\"https://ejemplo-app4.com\", \"_blank\");\n    }\n  };\n\n  return (\n    <ThemeProvider>\n      {/* 1Ô∏è‚É£ Si NO est√° logueado ‚Üí solo login */}\n      {!isLogged && (\n        <Login\n          onLogin={(user) => {\n            setCurrentUser(user);\n            setIsLogged(true);\n            setView(\"menu\");\n            setCity(null);\n            setCurrent(null);\n          }}\n        />\n      )}\n\n      {/* 2Ô∏è‚É£ Logueado y en men√∫ ‚Üí 4 opciones */}\n      {isLogged && view === \"menu\" && (\n        <Home onSelectApp={handleSelectApp} user={currentUser} />\n      )}\n\n      {/* 3Ô∏è‚É£ Logueado y en vista \"clima\" ‚Üí tu app de clima completa */}\n      {isLogged && view === \"clima\" && (\n        <>\n          <Header\n            city={city || { name: loadingCity ? \"Obteniendo ubicaci√≥n...\" : \"Ciudad\" }}\n            onCityChange={(c) => {\n              setCity(c);\n              setCityError(\"\");\n            }}\n          />\n\n          <main className=\"container row\">\n            {/* Mensaje si hay error de ubicaci√≥n */}\n            {cityError && (\n              <div className=\"card\" style={{ width: \"100%\" }}>\n                <p style={{ margin: 0, color: \"#f44336\" }}>{cityError}</p>\n              </div>\n            )}\n\n            {/* Si a√∫n no tenemos ciudad, mostramos solo un mensaje */}\n            {!city ? (\n              <div className=\"card\" style={{ width: \"100%\" }}>\n                <p style={{ margin: 0 }}>\n                  {loadingCity\n                    ? \"Obteniendo tu ubicaci√≥n...\"\n                    : \"Selecciona una ciudad para ver el clima.\"}\n                </p>\n              </div>\n            ) : (\n              <>\n                <div className=\"card\">\n                  <CurrentCard current={current} />\n                </div>\n\n                <div className=\"card\">\n                  <h3 style={{ marginTop: 0 }}>Hoy</h3>\n                  <WeatherList city={city} />\n                </div>\n\n                <div className=\"card\">\n                  <WeeklyForecast city={city} />\n                </div>\n              </>\n            )}\n          </main>\n        </>\n      )}\n    </ThemeProvider>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}